require("dotenv").config();
const fs = require("fs");
const path = require("path");
const Canvas = require("@kth/canvas-api").default;
const canvas = new Canvas(process.env.CANVAS_API_URL, process.env.CANVAS_API_TOKEN);

const logFilePath = path.resolve(__dirname, "processed_courses.log");
const failedLogPath = path.resolve(__dirname, "failed_courses.log");

const policyModules = [
  {
    title: "Kursspecifik information om generativ AI",
    pages: [
      { title: "Hur du använder mallarna för kursspecifik information om generativ AI", indent: 0, body: `<p>Varje kurs p&aring; KTH rekommenderas att ha kursspecifik information om generativ AI, i enlighet med beslut av Fakultetsr&aring;det. Den kursspecifika informationen om generativ AI b&ouml;r publiceras b&aring;de p&aring; Canvas och i kurs-PM.</p><h2>Steg-f&ouml;r-steg guide till att skriva din kursspecifika information om generativ AI</h2><p>Denna modul kommer med flera f&ouml;rskapade mallar d&auml;r varje mall representerar ett f&ouml;rh&aring;llningss&auml;tt till anv&auml;ndning av generativ AI och ger f&ouml;rslag p&aring; information till studenterna. F&ouml;r att anpassa mallarna till din kurs beh&ouml;ver du g&aring; igenom f&ouml;ljande steg:</p><ul><li>Steg 0: F&ouml;rs&auml;kra dig om att du &auml;r inf&ouml;rst&aring;dd i relevanta riktlinjer och lagar om generativ AI.&nbsp;</li><li>Steg 1: Reflektera &ouml;ver l&auml;randem&aring;len och ditt pedagogiska uppl&auml;gg.</li><li>Steg 2: Reflektera &ouml;ver effekten av att till&aring;ta olika generativa AI-verktyg (om relevant).&nbsp;</li><li>Steg 3: V&auml;lj mall och anpassa efter din kurs.&nbsp;</li><li>Steg 4: Kontrollera inneh&aring;llet och publicera.&nbsp;</li></ul><h3>Steg 0: F&ouml;rs&auml;kra dig om att du &auml;r inf&ouml;rst&aring;dd relevanta riktlinjer och lagar om generativ AI</h3><p>Kontrollera att du vet vad som g&auml;ller genom att l&auml;sa igenom f&ouml;ljande:</p><ul><li><a class="inline_disabled" title="L&auml;nk" href="https://intra.kth.se/utbildning/systemstod/generativ-ai/ethical-issues-and-legal-matters-1.1253707" target="_blank" rel="noopener">Juridiska aspekter kring generativ AI (intra.kth.se)</a>.</li><li>Riktlinjerna p&aring; sidan <a class="inline_disabled" title="L&auml;nk" href="https://intra.kth.se/utbildning/systemstod/generativ-ai/riktlinjer-1.1405092" target="_blank" rel="noopener">Att t&auml;nka p&aring; vid anv&auml;ndning av generativ AI (intra.kth.se)</a>.</li></ul><h3>Steg 1: Reflektera &ouml;ver l&auml;randem&aring;len och ditt pedagogiska uppl&auml;gg</h3><p>Hur generativ AI anv&auml;nds eller inte anv&auml;nds b&ouml;r st&auml;rka och st&ouml;dja l&auml;randem&aring;len och de pedagogiska id&eacute;erna i din kurs. Fundera p&aring; om och hur generativ AI kan hj&auml;lpa studenternas l&auml;rande i din kurs och hur detta p&aring;verkar dina uppgifter och din undervisning. Basera ditt st&auml;llningstagande om generativ AI p&aring; dessa &ouml;verv&auml;ganden.</p><p><strong>Obs! </strong>Kom ih&aring;g att begr&auml;nsningar endast kan g&auml;lla examinerande moment i kursen, men det &auml;r bra att ocks&aring; ge en rekommendation f&ouml;r icke-examinerande moment.&nbsp;</p><p>Detta steg &auml;r viktigt eftersom du beh&ouml;ver kunna f&ouml;rklara ditt st&auml;llningstagande kring AI i kursen och studenter &auml;r mer ben&auml;gna att f&ouml;lja regler de f&ouml;rst&aring;r. F&ouml;r fler tips om hur du kan hj&auml;lpa dina studenter, l&auml;s sidan <a class="inline_disabled" href="https://intra.kth.se/utbildning/systemstod/generativ-ai/talk-to-students-1.1374687" target="_blank" rel="noopener">Hur du pratar med dina studenter om generativ AI</a>.</p><h3>Steg 2: Reflektera &ouml;ver effekten av att till&aring;ta olika generativa AI-verktyg</h3><p>Betalversioner av generativa AI-verktyg &auml;r vanligtvis mer avancerade &auml;n gratisversionerna eller har fler funktioner. Om du till&aring;ter dina studenter att anv&auml;nda generativa AI-verktyg kan vissa av dem ha tillg&aring;ng till en betalversion medan andra m&aring;ste anv&auml;nda gratisversionen. Detta kan orsaka drastiskt olika upplevelser av hur anv&auml;ndbar generativ AI &auml;r och kan gynna de som har betalversioner av verktyget. Du kan vilja begr&auml;nsa vilka versioner som &auml;r till&aring;tna i kursens examinerande moment eller f&ouml;rse dina studenter med en betalversion, utan kostnad f&ouml;r studenterna.</p><p>Om anv&auml;ndningen av generativ AI &auml;r f&ouml;rv&auml;ntad eller obligatorisk m&aring;ste du kunna ge studenterna tillg&aring;ng till ett l&auml;mpligt verktyg utan kostnad f&ouml;r studenterna. Du rekommenderas ocks&aring; utbilda studenterna i hur de effektivt anv&auml;nder generativ AI.</p><p>Kom ocks&aring; ih&aring;g att ha en plan f&ouml;r vad du ska g&ouml;ra om en student v&auml;grar att anv&auml;nda generativ AI.</p><h3>Steg 3: V&auml;lj mall och anpassa efter din kurs</h3><p>De f&ouml;rskapade mallarna &auml;r breda d&aring; de &auml;r avsedda att hj&auml;lpa studenterna f&aring; en uppfattning av kursens f&ouml;rh&aring;llningss&auml;tt till anv&auml;ndning av generativ AI. N&auml;r du valt en mall s&aring; anpassar du den med de n&ouml;dv&auml;ndiga detaljerna s&aring; den uppfyller behoven i din kurs. G&aring; tillv&auml;ga p&aring; f&ouml;ljande vis:</p><ol style="list-style-type: decimal;"><li>V&auml;lj en av de fyra mallarna:&nbsp; <ul style="list-style-type: circle;"><li>Ingen till&aring;ten anv&auml;ndning av generativ AI-verktyg.</li><li>Endast till&aring;ten i specifika uppgifter. &nbsp;</li><li>Till&aring;tet efter givna riktlinjer.&nbsp;</li><li>Fri anv&auml;ndning av generativ AI-verktyg.&nbsp;</li></ul></li><li>Redigera den valda mallen och skriv in de detaljer som kr&auml;vs. Mallarna inneh&aring;ller f&auml;rgmarkerad text som &auml;r t&auml;nkt att guida dig till vad du beh&ouml;ver redigera. <ul style="list-style-type: circle;"><li>Var tydlig om vad som &auml;r till&aring;tet och otill&aring;tet. Motivera g&auml;rna varf&ouml;r.&nbsp;</li></ul></li><li>Spara din kursspecifika information.&nbsp;</li></ol><h3>Steg 4: Kontrollera inneh&aring;llet och publicera&nbsp;</h3><p>Till sist:</p><ol style="list-style-type: decimal;"><li>Kontrollera att du raderat all f&auml;rgmarkerad text i din valda mall.</li><li>Kontrollera att du f&aring;tt med allting.</li><li>Publicera din kursspecifika information om generativ AI.</li><li>Avpublicera sidan &ldquo;Kursansvarig har &auml;nnu inte specificerat information om generativ AI&rdquo;.&nbsp;</li></ol><p><strong>Obs!</strong> Kom ih&aring;g att &auml;ven l&auml;gga in informationen i kurs-PM.&nbsp;</p><p>&nbsp;</p><h2>Exempel p&aring; kursspecifik information om generativ AI</h2><p>Vi har samlat ett antal exempel p&aring; kursspecifik information om generativ AI som du kan inspireras av: <a class="inline_disabled" title="L&auml;nk" href="https://intra.kth.se/utbildning/systemstod/generativ-ai/exempel-kursspecifik-information-1.1405051" target="_blank" rel="noopener">Exempel p&aring; kursspecifik information om generativ AI (intra.kth.se)</a>.</p>` },
      { title: "Kursansvarig har ännu inte specificerat information om generativ AI", indent: 0, body: `<p>Kursansvarig f&ouml;r kursen har &auml;nnu inte specificerat information om generativ AI f&ouml;r kursen i Canvas. Kontrollera om denna information finns inlagd i kursens kurs-PM, annars kontaktar du ansvarig l&auml;rare och fr&aring;gar vad som g&auml;ller ang&aring;ende anv&auml;ndning av generativ AI i kursen.</p>` },
      { title: "Ingen tillåten användning av generativ AI-verktyg", indent: 1, body: `<p>All anv&auml;ndning av generativ AI &auml;r f&ouml;rbjuden i kursens examinerande moment. Du rekommenderas &auml;ven att undvika anv&auml;ndningen av generativ AI vid dina egna studier och under lektionstid. Detta grundar sig i att anv&auml;ndning av generativ AI anses ha en negativ inverkan p&aring; studenternas m&ouml;jlighet att uppfylla kursens l&auml;randem&aring;l. <span style="background-color: #f1c40f;">[L&auml;raren motiverar kursens inst&auml;llning till generativ AI utifr&aring;n hur anv&auml;ndandet p&aring;verkar kursens l&auml;randem&aring;l och/eller pedagogiska uppl&auml;gg]</span></p><h2>F&ouml;rbudet mot generativ AI inneb&auml;r att&nbsp;</h2><ul><li>Alla examinerande moment m&aring;ste utf&ouml;ras utan hj&auml;lp av generativ AI.&nbsp;</li><li>Alla inl&auml;mningar m&aring;ste vara helt m&auml;nniskoproducerade.&nbsp;</li></ul><p><strong>Du som student &auml;r fullt ansvarig</strong> f&ouml;r allt material du l&auml;mnar in och m&aring;ste kunna f&ouml;rsvara och f&ouml;rklara det helt utan st&ouml;d fr&aring;n generativ AI.&nbsp;</p><p>Studenter rekommenderas &auml;ven undvika att anv&auml;nda generativ AI f&ouml;r st&ouml;d och handledning vid egen instudering, d&aring; svaren &auml;r op&aring;litliga och kan utel&auml;mna viktiga delar av kursen. Ta i st&auml;llet st&ouml;d av dina medstudenter och l&auml;rare f&ouml;r handledning och st&ouml;d, samt anv&auml;nd kurslitteraturen f&ouml;r fakta.&nbsp;</p><p>&nbsp;</p><h2>Disciplin&auml;ra &aring;tg&auml;rder vid otill&aring;ten AI-anv&auml;ndning&nbsp;</h2><p>Allt du l&auml;mnar in m&aring;ste vara din egen prestation. Att anv&auml;nda generativ AI i kursens examinerande moment betraktas som<strong> otill&aring;ten hj&auml;lp och kan leda till disciplin&auml;ra &aring;tg&auml;rder</strong>. &nbsp;&nbsp;</p><p>&nbsp;</p><h2>Fr&aring;gor eller os&auml;kerheter?</h2><p>Kontakta kursansvarig f&ouml;r v&auml;gledning och f&ouml;rtydligande av denna information, eller om du felaktigt anklagas f&ouml;r att ha anv&auml;nt generativ AI i kursens examinerande moment.&nbsp;</p>` },
      { title: "Endast tillåten i specifika uppgifter", indent: 1, body: `<p>I kursen till&aring;ts anv&auml;ndning av generativ AI i specifika examinerande uppgifter under tydligt givna f&ouml;ruts&auml;ttningar och villkor baserade p&aring; uppgifternas karakt&auml;r. Anv&auml;ndning av generativ AI &auml;r f&ouml;rbjuden i &ouml;vriga examinerande moment och du rekommenderas &auml;ven att undvika att anv&auml;nda generativ AI i icke-examinerande moment. Anv&auml;ndningen av generativ AI f&ouml;r de utvalda uppgifterna anses fr&auml;mja l&auml;randet och uppfyllandet av l&auml;randem&aring;len. <span style="background-color: #f1c40f;">[<span>L&auml;raren motiverar kursens inst&auml;llning till generativ AI utifr&aring;n hur anv&auml;ndandet p&aring;verkar kursens l&auml;randem&aring;l och/eller pedagogiska uppl&auml;gg</span>]</span>&nbsp;</p><h2>Till&aring;ten anv&auml;ndning av generativ AI&nbsp;</h2><p>I f&ouml;ljande lista f&ouml;rklaras hur och i vilka examinerande uppgifter generativ AI f&aring;r anv&auml;ndas: &nbsp;</p><p><span style="background-color: #f1c40f;">[L&auml;rare l&auml;gger in lista av uppgifter och kort beskrivning av hur generativ AI f&aring;r anv&auml;ndas f&ouml;r varje uppgift. Till exempel:&nbsp;</span></p><ul><li><span style="background-color: #f1c40f;">&ldquo;Inl&auml;mningsuppgift A och D: brainstorming av id&eacute;er och uppl&auml;gg p&aring; uppgiften, samt &ouml;vers&auml;ttningar.&nbsp;</span><ul><li><span style="background-color: #f1c40f;">Restriktioner: Du f&aring;r bara &ouml;vers&auml;tta meningar eller ord, inte hela stycken. Du m&aring;ste arbeta vidare med id&eacute;-f&ouml;rslagen, du kan inte anv&auml;nda det genererade svaret rakt av. &nbsp;</span></li></ul></li><li><span style="background-color: #f1c40f;">Inl&auml;mningsuppgift E och presentation F: bildgenerering&rdquo;]&nbsp;</span></li></ul><p>Ytterligare information ges i respektive uppgift.&nbsp;</p><p><strong>Obs! </strong>Kom ih&aring;g att kritiskt granska material skapad av generativ AI. <strong>Du som student &auml;r fullt ansvarig</strong> f&ouml;r allt material du l&auml;mnar in och m&aring;ste kunna f&ouml;rsvara och f&ouml;rklara det helt utan st&ouml;d fr&aring;n generativ AI.</p><h3>Redovisning av AI-anv&auml;ndning&nbsp;</h3><p>F&ouml;r att s&auml;kerst&auml;lla akademisk transparens m&aring;ste du redovisa om och hur generativ AI har anv&auml;nts i ditt arbete. Redovisningen ska g&ouml;ras p&aring; f&ouml;ljande s&auml;tt: <span style="background-color: #f1c40f;">[L&auml;rare l&auml;gger in hur generativ AI ska redovisas i studenternas arbete. Exempelvis &ldquo;Bild skapad av AI-verktyg 1&rdquo; eller &ldquo;denna text har formaterats med AI-verktyg 2 med f&ouml;ljande prompt:...&rdquo;]</span></p><p><strong>Obs!</strong> AI-genererade referenser eller citat m&aring;ste kontrolleras s&aring; de &auml;r korrekta och relevanta. &nbsp;</p><p>&nbsp;</p><h2>Disciplin&auml;ra &aring;tg&auml;rder vid otill&aring;ten AI-anv&auml;ndning&nbsp;</h2><p>Allt du l&auml;mnar in m&aring;ste vara din egen prestation &ndash; &auml;ven om generativ AI anv&auml;nds som st&ouml;d m&aring;ste tankeg&aring;ngarna och slutsatserna vara dina egna. Anv&auml;ndning av generativ AI p&aring; ett otill&aring;tet s&auml;tt f&ouml;r examinerande moment betraktas som f&ouml;rs&ouml;k till vilseledande och <strong>kan leda till disciplin&auml;ra &aring;tg&auml;rder</strong>. Var d&auml;rf&ouml;r noga med att f&ouml;lja informationen p&aring; denna sida och det som specificerats i uppgifterna, samt redovisa din anv&auml;ndning av generativ AI.&nbsp;</p><p>&nbsp;</p><h2>Fr&aring;gor eller os&auml;kerheter? &nbsp;</h2><p>Kontakta kursansvarig f&ouml;r v&auml;gledning och f&ouml;rtydligande av denna information, eller om du felaktigt anklagas f&ouml;r otill&aring;ten anv&auml;ndning av generativ AI i kursens examinerande moment.</p>` },
      { title: "Tillåtet i hela kursen efter givna riktlinjer", indent: 1, body: `<p>Generativa AI-verktyg f&aring;r anv&auml;ndas i alla examinerande moment och uppgifter s&aring; l&auml;nge anv&auml;ndningen f&ouml;ljer kursens riktlinjer, om inget annat uttryckligen framg&aring;r. Du rekommenderas &auml;ven att f&ouml;lja kursens riktlinjer f&ouml;r icke-examinerande moment och uppgifter. Riktlinjerna f&ouml;r anv&auml;ndningen av generativ AI &auml;r utformade f&ouml;r att fr&auml;mja l&auml;randet och uppfyllandet av kursens l&auml;randem&aring;l. <span style="background-color: #f1c40f;">[<span>L&auml;raren motiverar kursens inst&auml;llning till generativ AI utifr&aring;n hur anv&auml;ndandet p&aring;verkar kursens l&auml;randem&aring;l och/eller pedagogiska uppl&auml;gg</span>]&nbsp;</span></p><h2>Riktlinjer f&ouml;r anv&auml;ndning av generativ AI&nbsp;</h2><p>Generativ AI f&aring;r anv&auml;ndas i kursens examinerande moment s&aring; l&auml;nge du anv&auml;nder det p&aring; ett s&auml;tt som &auml;r:</p><ul><li>ansvarsfullt</li><li>etiskt</li><li>akademiskt hederligt.</li><li><span style="background-color: #f1c40f;">[L&auml;raren l&auml;gger eventuellt till fler riktlinjer]</span></li></ul><p>Ett exempel p&aring; hur du uppfyller dessa riktlinjer &auml;r att vara transparent med din anv&auml;nding av generativ AI, vilket inneb&auml;r att din anv&auml;ndning m&aring;ste redovisas. Du finner fler kursspecifika exempel under rubriken "Exempel p&aring; till&aring;ten anv&auml;ndning".&nbsp;</p><p>Notera &aring;terigen att riktlinjerna bara m&aring;ste f&ouml;ljas f&ouml;r examinerande moment, men f&ouml;r att fr&auml;mja ditt l&auml;rande rekommenderas du att &auml;ven f&ouml;lja dem f&ouml;r icke-examinerande moment.</p><h3>Exempel p&aring; till&aring;ten anv&auml;ndning</h3><p>H&auml;r nedan ges exempel p&aring; till&aring;ten anv&auml;ndning av generativ AI i kursen. R&aring;dfr&aring;ga din l&auml;rare om du funderar p&aring; andra anv&auml;ndningsomr&aring;den.</p><p><span style="background-color: #f1c40f;">[L&auml;raren fyller i exempel p&aring; acceptabel anv&auml;ndning. <span style="background-color: #f1c40f;">Vid behov, skilj p&aring; krav f&ouml;r examinerande moment och rekommendationer f&ouml;r icke-examinerande moment. E</span>xempel p&aring; till&aring;ten anv&auml;ndning:</span></p><ul><li><span style="background-color: #f1c40f;"><strong>Id&eacute;generering:</strong> Anv&auml;nd AI f&ouml;r att f&aring; inspiration, strukturera tankar eller formulera fr&aring;gor. Det &auml;r dock alltid bra att t&auml;nka sj&auml;lvst&auml;ndigt f&ouml;rst, s&aring; att inte AI-verktyget begr&auml;nsar dina perspektiv]. &nbsp;</span></li><li><span style="background-color: #f1c40f;"><strong>Till&aring;tet anv&auml;ndningsomr&aring;de 2:</strong> F&ouml;rklaring av anv&auml;ndningsomr&aring;det, g&auml;rna med exempel och tips.]</span></li></ul><p><strong>Obs! </strong>Kom ih&aring;g att kritiskt granska material skapad av generativ AI. <strong>Du som student &auml;r fullt ansvarig</strong> f&ouml;r allt material du l&auml;mnar in och m&aring;ste kunna f&ouml;rsvara och f&ouml;rklara det helt utan st&ouml;d fr&aring;n generativ AI.&nbsp;</p><h3>Exempel p&aring; otill&aring;ten anv&auml;ndning</h3><p>H&auml;r nedan beskrivs n&aring;gra exempel p&aring; den anv&auml;ndning av generativ AI i examinerande moment som r&auml;knas som otill&aring;ten hj&auml;lp, f&ouml;rs&ouml;k till vilseledande eller fusk. Detta &auml;r <strong>inte</strong> en komplett lista, r&aring;dfr&aring;ga alltid din l&auml;rare om du &auml;r os&auml;ker p&aring; om din anv&auml;ndning &auml;r till&aring;ten.</p><p><span style="background-color: #f1c40f;">[L&auml;raren listar otill&aring;ten anv&auml;ndning. <span style="background-color: #f1c40f;"><span style="background-color: #f1c40f;">Vid behov, skilj p&aring; krav f&ouml;r examinerande moment och rekommendationer f&ouml;r icke-examinerande moment.</span></span> Exempel p&aring; otill&aring;ten anv&auml;ndning:</span></p><ul><li><span style="background-color: #f1c40f;"><strong>Fullst&auml;ndig uppgiftsl&ouml;sning:</strong> AI f&aring;r inte anv&auml;ndas f&ouml;r att generera hela inl&auml;mningsuppgifter, rapporter eller tentasvar.</span></li><li><span style="background-color: #f1c40f;"><strong>Otill&aring;tet anv&auml;ndningsomr&aring;de 2:</strong> F&ouml;rklaring av anv&auml;ndningsomr&aring;det.]</span></li></ul><p>&nbsp;</p><h2>Redovisning av AI-anv&auml;ndning&nbsp;</h2><p>F&ouml;r att s&auml;kerst&auml;lla akademisk transparens m&aring;ste du redovisa om och hur AI har anv&auml;nts i ditt arbete. Redovisningen ska g&ouml;ras p&aring; f&ouml;ljande s&auml;tt: <span style="background-color: #f1c40f;">[L&auml;rare l&auml;gger in hur generativ AI ska redovisas i studenternas arbete. Exempelvis &ldquo;Bild skapad av AI-verktyg 1&rdquo; eller &ldquo;denna text har formaterats med AI-verktyg 2 med f&ouml;ljande prompt:...&rdquo;]&nbsp;</span></p><p>&nbsp;</p><h2>Disciplin&auml;ra &aring;tg&auml;rder vid otill&aring;ten AI-anv&auml;ndning&nbsp;</h2><p>Allt du l&auml;mnar in m&aring;ste vara din egen prestation &ndash; &auml;ven om generativ AI anv&auml;nds som st&ouml;d m&aring;ste tankeg&aring;ngarna och slutsatserna vara dina egna. Anv&auml;ndning av generativ AI p&aring; ett otill&aring;tet s&auml;tt i examinerande moment betraktas som f&ouml;rs&ouml;k till vilseledande och<strong> kan leda till disciplin&auml;ra &aring;tg&auml;rder</strong>. Var d&auml;rf&ouml;r noga med att f&ouml;lja informationen p&aring; denna sida samt redovisa din anv&auml;ndning av generativ AI.&nbsp;</p><p>&nbsp;</p><h2>Fr&aring;gor eller os&auml;kerheter? &nbsp;</h2><p>Kontakta kursansvarig f&ouml;r v&auml;gledning och f&ouml;rtydligande av denna information, eller om du felaktigt anklagas f&ouml;r otill&aring;ten anv&auml;ndning av generativ AI i kursens examinerande moment.&nbsp;</p>` },
      { title: "Fri användning av generativ AI-verktyg", indent: 1, body: `<p>I kursen f&aring;r generativ AI anv&auml;ndas efter studenternas eget tycke i alla examinerande moment och uppgifter, f&ouml;rutom om anv&auml;ndandet bryter mot andra regler eller uppf&ouml;randekoder. Anv&auml;ndningen av generativ AI anses fr&auml;mja l&auml;randet och uppfyllandet av kursens l&auml;randem&aring;l. <span style="background-color: #f1c40f;">[<span>L&auml;raren motiverar kursens inst&auml;llning till generativ AI utifr&aring;n hur anv&auml;ndandet p&aring;verkar kursens l&auml;randem&aring;l och/eller pedagogiska uppl&auml;gg</span>]</span></p><h2>Till&aring;ten anv&auml;ndning av generativ AI&nbsp;</h2><p>Du som student f&aring;r sj&auml;lv ta st&auml;llning till vad du anser vara etisk och studiefr&auml;mjande anv&auml;ndning av generativ AI. Ditt st&auml;llningstagande beh&ouml;ver inkludera existerande regler och uppf&ouml;randekoder p&aring; KTH samt vara juridiskt och etiskt f&ouml;rsvarbar, exempelvis g&auml;llande hantering av personuppgifter eller upphovsr&auml;ttsskyddat material. G&ouml;r medvetna val och h&aring;ll dig uppdaterad ang&aring;ende relevanta lagar, domstolsbeslut och andra juridiska beslut kring AI och generativ AI.</p><p><span style="background-color: #f1c40f;">[L&auml;raren l&auml;gger in hur studenterna ska f&aring; st&ouml;d att ta st&auml;llning, exempelvis genom att det diskuteras p&aring; lektionstid]</span></p><p><strong>Obs! </strong>Kom ih&aring;g att kritiskt granska material skapad av generativ AI. <strong>Du som student &auml;r fullt ansvarig</strong> f&ouml;r allt material du l&auml;mnar in och m&aring;ste kunna f&ouml;rsvara och f&ouml;rklara det helt utan st&ouml;d fr&aring;n generativ AI.&nbsp;</p><p>&nbsp;</p><h2>Redovisning av AI-anv&auml;ndning&nbsp;</h2><p>Du som student avg&ouml;r n&auml;r och hur du beh&ouml;ver redovisa din anv&auml;ndning av generativ AI.</p><p>&nbsp;</p><h2>Fr&aring;gor eller os&auml;kerheter?&nbsp;</h2><p>Kontakta kursansvarig f&ouml;r v&auml;gledning och f&ouml;rtydligande av denna information.</p>` },
    ],
  },
  {
    title: "Course specific information about generative AI",
    pages: [
      { title: "How to use the templates for course specific information about generative AI", indent: 0, body: `<p>Each course at KTH are recommended to have course specific information about generative AI, in accordance with the decision of the Faculty Council. This course specific information should be published both in Canvas and in the course memo.</p><h2>Step-by-step guide to writing your course specific information about generative AI</h2><p>This module comes with several pre-created templates, where each template represents an approach to the use of generative AI and give suggestions for information to students. To adapt the templates to your course, you need to go through the following steps:</p><ul><li>Step 0: Ensure that you understand the relevant guidelines and laws about generative AI.</li><li>Step 1: Reflect on the learning objectives and your pedagogical approach.</li><li>Step 2: Reflect on the impact of allowing different generative AI tools (if relevant).</li><li>Step 3: Choose a template and adapt it to your course.</li><li>Step 4: Check the content and publish.</li></ul><h3>Step 0: Make sure you understand the relevant guidelines and laws about generative AI</h3><p>Check that you know what applies by reading through the following:</p><ul><li><a class="inline_disabled" title="L&auml;nk" href="https://intra.kth.se/en/utbildning/systemstod/generativ-ai/ethical-issues-and-legal-matters-1.1253707" target="_blank" rel="noopener">Legal aspects of generative AI (intra.kth.se)</a>.</li><li>The guidelines on the page <a class="inline_disabled" title="L&auml;nk" href="https://intra.kth.se/en/utbildning/systemstod/generativ-ai/riktlinjer-1.1405092" target="_blank" rel="noopener">Considerations for using generative AI (intra.kth.se)</a>.</li></ul><h3>Step 1: Reflect on the learning objectives and your pedagogical approach</h3><p>How generative AI is used or not used should strengthen and support the learning objectives and pedagogical ideas in your course. Consider whether and how generative AI can help students learn in your course and how this affects your assignments and your teaching. Base your position to generative AI on these considerations.</p><p><strong>Note!</strong> Remember that restrictions can only apply to graded elements of the course, but it is good to also provide recommendations for non-graded elements.</p><p>This step is important as you need to be able to explain your position to generative AI in the course, and because students are more likely to follow rules they understand. For more tips on how to help your students, read the page <a class="inline_disabled" href="https://intra.kth.se/en/utbildning/systemstod/generativ-ai/talk-to-students-1.1374687" target="_blank" rel="noopener">How to talk to your students about generative AI</a>.</p><h3>Step 2: Reflect on the impact of allowing different generative AI tools</h3><p>Paid versions of generative AI tools are typically more advanced than the free versions or have more features. If you allow your students to use generative AI tools, some of them may have access to a paid version while others must use the free version. This can cause drastically different experiences of how useful generative AI is and may benefit those who have paid versions of the tool. You may want to limit which versions are allowed in the graded assignments and other examinations or provide your students with a paid version, at no cost to students.</p><p>If the use of generative AI is expected or required, you need to be able to provide your students access to an appropriate tool at no cost to students. We also recommend that you train your students on how to effectively use generative AI.</p><p>Also, remember to have a plan for what to do if a student refuses to use generative AI.</p><h3>Step 3: Choose a template and adapt it to your course</h3><p>The pre-created templates are broad as they are intended to help students get an idea of ​​the course's approach to the use of generative AI. Once you have chosen a template, customize it with the necessary details to meet the needs of your course. Follow these steps:</p><ol style="list-style-type: decimal;"><li>Choose one of the four templates: <ul style="list-style-type: circle;"><li>No use of generative AI tools allowed.</li><li>Allowed only in specific assignments.</li><li>Allowed according to given guidelines.</li><li>Free use of generative AI tools.</li></ul></li><li>Edit the selected template and enter the required details. The templates contain highlighted text that is intended to guide you to what you need to edit. <ul style="list-style-type: circle;"><li>Be clear about what is allowed and what is not allowed. Please justify why.</li></ul></li><li>Save your course specific information.</li></ol><h3>Step 4: Check the content and publish</h3><p>Finally:</p><ol style="list-style-type: decimal;"><li>Check that you have deleted all the highlighted text in your chosen template.</li><li>Check that you have included everything.</li><li>Publish the course specific information about generative AI.</li><li>Unpublish the page &ldquo;The course responsible has not yet specified information about generative AI&rdquo;.</li></ol><p><strong>Note!</strong> Remember to also add the information to the course memo.</p><p>&nbsp;</p><h2>Examples of course specific information about generative AI</h2><p>We have collected a number of examples of course specific information about generative AI that you can be inspired by: <a class="inline_disabled" title="L&auml;nk" href="https://intra.kth.se/en/utbildning/systemstod/generativ-ai/exempel-kursspecifik-information-1.1405051" target="_blank" rel="noopener">Examples of course-specific information about generative AI (intra.kth.se)</a>.</p>` },
      { title: "The course responsible has not yet specified information about generative AI", indent: 0, body: `<p>The course responsible has not yet specified information about generative AI for the course in Canvas. Check if the information is included in the course memo, otherwise contact the instructor and ask what applies regarding the use of generative AI in the course.</p>` },
      { title: "No use of generative AI tools allowed", indent: 1, body: `<p>All use of generative AI is prohibited in the course's examination and graded assignments. You are also advised to avoid the use of generative AI in your own studies and during class time. This is based on the fact that the use of generative AI is considered to have a negative impact on students' ability to meet the course's learning objectives. <span style="background-color: #f1c40f;">[The teacher justifies the course's approach to generative AI based on how its use affects the course's learning objectives and/or pedagogical approach.]</span></p><h2>The ban on generative AI means that</h2><ul><li>All examination and graded assignments must be carried out without the help of generative AI.</li><li>All submissions must be completely human-generated.</li></ul><p><strong>You as a student are fully responsible </strong>for all material you submit and must be able to defend and explain it completely without the support of generative AI.</p><p>Students are also advised to avoid using generative AI for support and guidance during their own study, as the answers are unreliable and may omit important parts of the course. Instead, seek support from your fellow students and teachers for guidance and support, and use the course literature for facts.</p><p>&nbsp;</p><h2>Disciplinary action for unauthorized use of AI</h2><p>Everything you submit must be your own work. Using generative AI in the course's examination and graded assignments is considered <strong>unauthorized assistance and may result in disciplinary action</strong>.</p><p>&nbsp;</p><h2>Questions or concerns?</h2><p>Contact the course responsible for guidance and clarification of this information, or if you are wrongly accused of using generative AI in the course's examination and graded assignments.</p>` },
      { title: "Allowed only in specific assignments", indent: 1, body: `<p>The course allows the use of generative AI in specific graded assignments under clearly stated conditions and terms based on the nature of the assignments. The use of generative AI is prohibited in other graded assignments and examinations and you are also advised to avoid using generative AI in non-graded assignments. The use of generative AI for the selected assignments is considered to promote learning and the fulfillment of the learning objectives. <span style="background-color: #f1c40f;">[The teacher justifies the course's approach to generative AI based on how its use affects the course's learning objectives and/or pedagogical approach.]</span></p><h2>Permitted use of generative AI</h2><p>The following list explains how and in which graded assignments generative AI may be used:</p><p><span style="background-color: #f1c40f;">[Teacher inserts a list of assignments and a short description of how generative AI may be used for each assignment. For example:</span></p><ul><li><span style="background-color: #f1c40f;">&ldquo;Assignment A and D: brainstorming ideas and structure for the assignment, as well as translations.</span><ul><li><span style="background-color: #f1c40f;">Restrictions: You may only translate sentences or words, not entire paragraphs. You must work further with the idea suggestions, you cannot use the generated answer directly.</span></li></ul></li><li><span style="background-color: #f1c40f;">Assignment E and presentation F: image generation&rdquo;]</span></li></ul><p>More information can be found in the respective assignment.</p><p><strong>Note!</strong> Remember to critically review material created by generative AI. <strong>You as a student are fully responsible</strong> for all material you submit and must be able to defend and explain it completely without support from generative AI.</p><h3>Disclosure of AI use</h3><p>To ensure academic transparency, you must disclose whether and how generative AI has been used in your work. The disclosure should be made as follows: <span style="background-color: #f1c40f;">[The teacher specifies how generative AI use should be reported in the students&rsquo; work. For example: &ldquo;Image created using AI tool 1&rdquo; or &ldquo;This text has been formatted using AI tool 2 with the following prompt:...&rdquo;]</span></p><p><strong>Note!</strong> AI-generated references or quotes must be checked for accuracy and relevance.</p><p>&nbsp;</p><h2>Disciplinary action for unauthorized use of AI</h2><p>Everything you submit must be your own work &ndash; even if generative AI is used as support, the thinking and conclusions must be your own. Using generative AI in an unauthorized way for examination and graded assignments is considered an attempt to mislead and <strong>may lead to disciplinary action</strong>. Therefore, be sure to follow the information on this page and what is specified in the assignments, and disclose your use of generative AI.</p><p>&nbsp;</p><h2>Questions or concerns?</h2><p>Contact the course responsible for guidance and clarification of this information, or if you are wrongly accused of unauthorized use of generative AI in the course's examination and graded assignments.</p>` },
      { title: "Allowed throughout the course according to given guidelines", indent: 1, body: `<p>Generative AI tools may be used in all examination and graded assignments as long as the use follows the course guidelines, unless otherwise explicitly stated. You are also advised to follow the course guidelines for non-graded assignments. The guidelines for the use of generative AI are designed to promote learning and the fulfillment of the course learning objectives. <span style="background-color: #f1c40f;">[The teacher justifies the course's approach to generative AI based on how its use affects the course's learning objectives and/or pedagogical approach.]</span></p><h2>Guidelines for the use of generative AI</h2><p>Generative AI may be used in the course's examination and graded assignments as long as you use it in a manner that is</p><ul><li>responsible</li><li>ethical</li><li>academically honest.</li><li><span style="background-color: #f1c40f;">[The teacher adds any additional guidelines]</span></li></ul><p>One example on how to fulfill these guidelines is to be transparent with your use of generative AI, which means that your use must be disclosed. You will find more course-specific examples under the heading "Examples of permitted use".&nbsp;</p><p>Note that the guidelines must be followed for examination and graded assignments, but you are advised to also follow them outside of examinations and for non-graded assignments.</p><h3>Examples of permitted use</h3><p>Below are examples of permitted use of generative AI in the course. Consult your teacher if you are considering other areas of use.</p><p><span style="background-color: #f1c40f;">[The teacher fills in examples of acceptable use. If necessary, distinguish between requirements for exam elements and recommendations for non-exam elements. Examples of permitted use:</span></p><ul><li><span style="background-color: #f1c40f;"><strong>Idea generation:</strong> Use AI to get inspiration, structure thoughts or formulate questions. However, it is always good to think independently first, so that the AI ​​tool does not limit your perspectives].</span></li><li><span style="background-color: #f1c40f;"><strong>Permitted area of use 2:</strong> Explanation of the area of use, preferably with examples and tips.]</span></li></ul><p><strong>Note!</strong> Remember to critically review material created by generative AI. <strong>You as a student are fully responsible </strong>for all material you submit and must be able to defend and explain it completely without support from generative AI.</p><h3>Examples of prohibited use</h3><p>Below is a description of the use of generative AI in examination and graded assignments that is considered unauthorized assistance, attempted deception or cheating. This is&nbsp;<strong>not</strong> a complete list, always consult your teacher if you are unsure whether your use is permitted.</p><p><span style="background-color: #f1c40f;">[The teacher lists unauthorized use. If necessary, distinguish between requirements for exam elements and recommendations for non-exam elements. Examples of prohibited uses:</span></p><ul><li><span style="background-color: #f1c40f;"><strong>Complete assignment solution:</strong> AI may not be used to generate entire assignments, reports, or exam answers.</span></li><li><span style="background-color: #f1c40f;"><strong>Prohibited are of use 2: </strong>Explanation of the area of use.]</span></li></ul><p>&nbsp;</p><h2>Disclosure of AI use</h2><p>To ensure academic transparency, you must disclose whether and how generative AI has been used in your work. The disclosure should be made as follows:<span>&nbsp;</span><span style="background-color: #f1c40f;">[The teacher specifies how generative AI use should be reported in the students&rsquo; work. For example: &ldquo;Image created using AI tool 1&rdquo; or &ldquo;This text has been formatted using AI tool 2 with the following prompt:...&rdquo;]</span></p><p>&nbsp;</p><h2>Disciplinary action for unauthorized use of AI</h2><p>Everything you submit must be your own work &ndash; even if generative AI is used as support, the thinking and conclusions must be your own. Using generative AI in an unauthorized way for examination and graded assignments is considered an attempt to mislead and<span>&nbsp;</span><strong>may lead to disciplinary action</strong>. Therefore, be sure to follow the information on this page, and disclose your use of generative AI.</p><p>&nbsp;</p><h2>Questions or concerns?</h2><p>Contact the course responsible for guidance and clarification of this information, or if you are wrongly accused of unauthorized use of generative AI in the course's examination and graded assignments.</p>` },
      { title: "Free use of generative AI tools", indent: 1, body: `<p>In the course, generative AI may be used at the students' own discretion in all examination and graded assignments, unless the use violates other rules or codes of conduct. The use of generative AI is considered to promote learning and the fulfillment of the course's learning objectives. <span style="background-color: #f1c40f;">[The teacher justifies the course's approach to generative AI based on how its use affects the course's learning objectives and/or pedagogical approach.]</span></p><h2>Permitted use of generative AI</h2><p>You as a student should decide for yourself how to use generative AI in a way that is ethical and promotes learning. Your decision must consider existing rules and codes of conducts at KTH, and it must be legally and ethically defensible, for example regarding the handling of personal data or copyrighted material. Make informed choices and stay up-to-date on relevant laws, court decisions, and other legal decisions surrounding AI and generative AI.</p><p><span style="background-color: #f1c40f;">[The teacher adds how the students will get support in making their decision, for example by discussing it during class time]</span></p><p><strong>Note! </strong>Remember to critically review material created by generative AI. <strong>You as a student are fully responsible</strong> for all material you submit and must be able to defend and explain it completely without support from generative AI.</p><p>&nbsp;</p><h2>Disclosure of AI use</h2><p>You as a student decide when and how you need to disclose your use of generative AI.</p><p>&nbsp;</p><h2>Questions or concerns?</h2><p>Contact the course responsible for guidance and clarification of this information.</p>` },
    ],
  },
];

const sisTermIds = [];
const specificCourseIds = [];

function getProcessedCourses() {
  if (!fs.existsSync(logFilePath)) return new Set();
  const lines = fs
    .readFileSync(logFilePath, "utf-8")
    .split("\n")
    .filter(Boolean);
  return new Set(lines.map((id) => id.trim()));
}

function logProcessedCourse(courseId) {
  fs.appendFileSync(logFilePath, `${courseId}\n`);
}

function logFailedCourse(courseId) {
  fs.appendFileSync(failedLogPath, `${courseId}\n`);
}

async function addPolicyModulesToCourse(courseId) {
  try {
    for (const moduleDef of policyModules) {
      const createdPages = [];

      for (const page of moduleDef.pages) {
        const body = page.body;
        if (!body) {
          console.warn(`⚠️  No content for page "${page.title}" – skipping.`);
          continue;
        }

        const createdPage = await canvas.request(
          `courses/${courseId}/pages`,
          "POST",
          {
            wiki_page: {
              title: page.title,
              body,
              published: false,
            },
          }
        );

        createdPages.push({ ...createdPage.body, indent: page.indent ?? 0 });
      }

      const createdModule = await canvas.request(
        `courses/${courseId}/modules`,
        "POST",
        {
          module: {
            name: moduleDef.title,
            published: false,
          },
        }
      );

      for (const page of createdPages) {
        await canvas.request(
          `courses/${courseId}/modules/${createdModule.body.id}/items`,
          "POST",
          {
            module_item: {
              type: "Page",
              page_url: page.url,
              published: false,
              indent: page.indent ?? 0,
            },
          }
        );
      }
    }

    logProcessedCourse(courseId);
  } catch (error) {
    console.error(`❌ Error in course ID ${courseId}:`, error.message);
    logFailedCourse(courseId);
  }
}

async function resolveNumericTermIds(sisTermIds) {
  const numericIds = [];

  for (const sisId of sisTermIds) {
    console.log(`🔎 Resolving numeric term ID for SIS term "${sisId}"…`);
    try {
      // Use canvas.get(...) rather than canvas.request for this endpoint
      const resp = await canvas.get(`accounts/1/terms/sis_term_id:${sisId}`);
      const term = resp.body;
      numericIds.push(term.id);
      console.log(`✅ SIS term ${sisId} → numeric term ${term.id}`);
    } catch (e) {
      console.error(`⚠️ Could not resolve SIS term ${sisId}:`, e.message);
    }
  }

  return numericIds;
}

/**
 * Fetch all courses for each numeric term ID and print each course.id.
 * Returns the array of distinct course IDs.
 */
async function getCoursesFromTerms(termIds) {
  const allCourseIds = new Set();

  for (const termId of termIds) {
    console.log(`\n🔎 Fetching courses for numeric term ID: ${termId}…`);

    let fetchedCount = 0;

    // listItems on "accounts/1/courses" with enrollment_term_id
    for await (const course of canvas.listItems("accounts/1/courses", {
      enrollment_term_id: termId,
      per_page: 100,
    })) {
      fetchedCount++;
      allCourseIds.add(course.id);
      console.log(course.id); // print the actual course ID
    }

    console.log(`✅ Fetched ${fetchedCount} total courses for term ${termId}.\n`);
  }

  return Array.from(allCourseIds);
}

async function start() {
  const alreadyProcessed = getProcessedCourses();

  let courseIds = [];
  if (sisTermIds.length > 0) {
    // 1. Resolve SIS → numeric
    const numericTermIds = await resolveNumericTermIds(sisTermIds);

    // 2. Fetch + print all course IDs under each numeric term
    courseIds = await getCoursesFromTerms(numericTermIds);
  } else if (specificCourseIds.length > 0) {
    courseIds = specificCourseIds;
  }

  // Filter out those we've already processed
  const filtered = courseIds.filter(
    (id) => !alreadyProcessed.has(String(id))
  );
  if (filtered.length === 0) {
    console.log("No unprocessed course IDs remaining.");
    return;
  }

  console.log(`\n🚀 Processing ${filtered.length} course(s)…\n`);
  let count = 0;
  for (const id of filtered) {
    await addPolicyModulesToCourse(id);
    count++;
    process.stdout.write(".");
    if (count % 20 === 0) {
      process.stdout.write(` ${count} processed (last: ${id})\n`);
    }
  }
  console.log(`\n\n✅ Done processing ${count} course(s).`);
}

start().catch((err) => {
  console.error("Unexpected error:", err);
});